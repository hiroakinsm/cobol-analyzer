## ソース解析 仕様概要

### 概要

ソース解析サービスは、ユーザーが指定したソースコード（単一ファイルまたは複数ファイル）を静的に解析し、その構造、依存関係、品質などの情報を抽出・可視化する機能を提供する。解析対象の言語は、COBOL、アセンブラ、PL/1、Java、C/C++、VB/VBA、PHP、Rust、Python、.NET、C#とし、IBM、日立、富士通、NEC、ユニシス、Micro Focusの各ベンダーのダイアレクトに対応する。また、AI/RAG/MLサーバーを用いた高度な解析機能を提供する。

解析結果は、AST（抽象構文木）、依存関係グラフ、各種メトリクスなどの形でデータベースに格納され、本システムの他のサービス（ソース変換、DB変換、画面処理変換、フォーム処理変換、外部システム連携変換、ダイアレクト変換、モダナイゼーション）から利用される。また、ユーザーはWebインターフェースを介して、解析結果を閲覧・検索・分析することができる。

### 前提条件

-   ユーザーは、システムにログイン済みであり、ソース解析を実行する権限を有していること。
-   解析対象のソースコードが、アクセス可能な場所に保存されていること（ローカルファイルシステム、バージョン管理システムなど）。

### 主要機能

1.  **ソースコード指定**: 解析対象のソースコードを、ファイルパス、ディレクトリ、またはバージョン管理システムのURLなどを用いて指定する。
2.  **解析種別指定**: 解析種別（単一ソース解析、複数ソースサマリ解析）を選択する。
3.  **プロジェクト作成**: ソース解析のプロジェクトを新規作成し、解析対象のソースコード、解析種別、解析パラメータを紐づけて、データベースに保存する。
4.  **解析パラメータ設定**: 解析対象言語、解析レベル、詳細オプション、インポートパスなどを設定し、プロジェクトに紐づけてデータベースに保存する。
5.  **解析シミュレーション**: 解析実行前に、処理時間、リソース使用量、検出される問題点などを予測・表示する。
6.  **解析実行**: 指定されたソースコードの構文解析、意味解析、詳細解析（AI/RAG/MLサーバーによる）を実行する。
7.  **解析進捗のダッシュボード表示**: 解析処理の進捗状況をリアルタイムにダッシュボードに表示する。
8.  **AI/RAG/MLによる詳細解析**: デフォルトで、AI/RAG/MLサーバーを用いて、高度な解析（高度プログラム構造解析、バグ予測、問題点検出、コードクローン検出、技術的負債分析、セキュリティ脆弱性診断、コンプライアンスチェックなど）を実行する。
9.  **解析結果のデータベース保存**: 解析結果（AST、依存関係、メトリクス、詳細解析結果など）をデータベース（PostgreSQL、MongoDB、Milvus）に保存する。
10. **解析結果のダッシュボード表示**: 解析結果（AST、依存関係、メトリクス、詳細解析結果など）を、表形式、ツリービュー、各種グラフなどでわかりやすくダッシュボードに表示する。
11. **解析結果のドキュメント出力**: 解析結果を、テンプレートマスタ設定内容や、指定された形式（PDF、JSON、XML、CSVなど）でより詳細にドキュメントとして出力する。
12. **解析履歴管理**: 解析履歴（日時、対象ソース、パラメータ、結果など）を保存し、過去の解析結果を参照・比較できる。
13. **エラーハンドリング**: 解析中に発生したエラーを適切に処理し、ユーザーに通知する。
14. **各種マスタとの連携**: 環境マスタ、解析マスタ、テンプレートマスタなどの各種マスタと連携して動作する。
15. **他サービスとの連携**: ソース変換、DB変換、画面処理変換、フォーム処理変換、外部システム連携変換、ダイアレクト変換、モダナイゼーションなどの他のサービスと連携し、解析結果を提供する。
16. **変換要否の判定**: 解析結果をもとに、ソース変換サービスで各変換（DB変換、画面処理変換、フォーム処理変換、外部システム連携変換、ダイアレクト変換）が必要かどうかを判定する。
17. **知見の蓄積**: ソースコードの解析から得られた有益な知識情報（言語特性、ロジックなど）を、顧客や個人情報を含まない形で、データベースの専用領域に蓄積する。
18. **蓄積された知見の活用**: 蓄積された知識情報を、後続の解析処理において参照し、解析精度の向上や、ユーザーへの情報提供に活用する。

## ソース解析 機能仕様

### 機能詳細

#### 1. ソースコード指定

-   **入力**:
    -   ソースコードファイル（単一ファイルまたは複数ファイル）
    -   ファイルパス、ディレクトリ
-   **出力**:
    -   なし（指定情報をアプリケーションサーバーのメモリに保存）
-   **処理内容**:
    -   ユーザーが、Webインターフェースを介して、解析対象のソースコードを指定する。
    -   単一ファイル、複数ファイルの一括指定、ディレクトリ指定、ワイルドカード指定からの指定など、柔軟な指定方法をサポートする。
    -   アプリケーションサーバーは、指定されたソースコードを、ローカルファイルシステムなどから取得する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー

#### 2. 解析種別指定

-   **入力**:
    -   解析種別（単一ソース解析、複数ソースサマリ解析）
-   **出力**:
    -   なし（指定情報をアプリケーションサーバーのメモリに保存）
-   **処理内容**:
    -   ユーザーが、Webインターフェースを介して、実行したい解析の種別を選択する。
    -   アプリケーションサーバーは、ユーザーが選択した解析種別をメモリに保存する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー

#### 3. プロジェクト作成

-   **入力**:
    -   プロジェクト名
    -   説明（任意）
    -   ソースコード指定情報
    -   解析種別
    -   解析パラメータ
    -   顧客情報
-   **出力**:
    -   作成されたプロジェクトのID
-   **処理内容**:
    -   ユーザーが、Webインターフェースを介して、新規プロジェクトの名前、説明、ソースコード指定情報、解析種別、解析パラメータを入力する。
    -   アプリケーションサーバーは、入力された情報をもとに、新規プロジェクトを作成し、データベース(PostgreSQL)に保存する。その際、ログインユーザーの顧客情報をプロジェクトに紐づける。
    -   アプリケーションサーバーは、作成されたプロジェクトのIDをWebサーバー経由でユーザーに通知する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL

#### 4. 解析パラメータ設定

-   **入力**:
    -   プロジェクトID
    -   解析対象ソースファイル（COBOL, アセンブラ, PL/1, Java, C/C++, VB/VBA, PHP, Rust, Python, .NET, C#）
    -   解析レベル（構文解析、意味解析、詳細解析など *デフォルトでは全てを使用する設定）
    -   解析オプション（適用するルール、詳細解析の種類など）
    -   インポートパス（ソースコードの依存関係解決に使用）
-   **出力**:
    -   画面出力（プロジェクト（ソース解析）、関連パラメーター、処理ステータス（新規、編集、実施中、中断）、解析シミュレーション実行ボタン）
-   **処理内容**:
    -   ユーザーが、Webインターフェースを介して、既存プロジェクトを選択し、解析パラメータを設定する。
    -   ユーザーが、解析パラメータ設定の内容を保存し完了すると、ユーザーの指示により解析シミュレーションに遷移できる。
    -   アプリケーションサーバーは、データベースに設定完了したプロジェクトや、関連するパラメータ、プロジェクトの実施状況を保存する。
    -   ソース解析実施中のプロジェクトは、ソース解析処理を完了するか、ユーザーが明示的に処理を終了しない限り、解析シミュレーションやソース解析処理を実行できない。
    -   アプリケーションサーバーは、環境マスタからインポートパスを読み込み、ParserManagerに設定する。
    -   ParserManagerは、解析対象ソースファイルの内容から、解析を実施するParserを指定し解析対象ソースファイルをParserに渡す。
    -   アプリケーションサーバーは、設定された解析パラメータを、プロジェクトIDと関連付けてデータベース(PostgreSQL)に保存する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   ParserManager
    -   PostgreSQL

#### 5. 解析シミュレーション

-   **入力**:
    -   プロジェクトID
    -   解析パラメータ設定でデータベースに保存された、以下保存内容
        -   解析対象ソースファイル（COBOL, アセンブラ, PL/1, Java, C/C++, VB/VBA, PHP, Rust, Python, .NET, C#）
        -   解析レベル（構文解析、意味解析、詳細解析など *デフォルトでは全てを使用する設定）
        -   解析オプション（適用するルール、詳細解析の種類など）
        -   インポートパス（ソースコードの依存関係解決に使用）
-   **出力**:
    -   解析処理をシミュレートし、処理進捗（シミュレーション、完了）画面上に結果出力（解析に必要な時間、問題点）、解析パラメータ設定画面へのリンク、解析実行のリンク、終了してメインメニューに戻るリンクを表示
    -   シミュレーション結果のデータベースへの記録
-   **処理内容**:
    -   ユーザーが、Webインターフェースを介して、設定した解析パラメータを画面上で確認し、シミュレーション開始を指示する。
    -   アプリケーションサーバーは、解析シミュレーション処理（実行時間の見積もり、リソース使用量の見積もり、潜在的な問題点の検出など）を実施し、結果をデータベースに保存し、画面上に表示する。
    -   アプリケーションサーバーは、AI/RAG/MLサーバーと連携し、より精度の高いシミュレーションを行う。例えば、AI/RAG/MLサーバーは、過去の解析実績や類似プロジェクトのデータを用いて、解析時間を予測したり、リソース使用量を見積もったりする。
    -   ユーザーは、解析シミュレーションの結果を確認し、解析実施を指定するか、解析パラメータ指定に戻るか、終了してメインメニューに戻るかを選択できる。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL
    -   AI/RAG/MLサーバー

#### 6. 解析実行

-   **入力**:
    -   プロジェクトID
    -   解析対象ソースファイル
    -   解析パラメータ
-   **出力**:
    -   解析結果（AST、依存関係、メトリクスなど）
    -   エラー情報
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDに関連付けられた解析パラメータをデータベースから取得する。
    -   アプリケーションサーバーが、ParserManagerを呼び出し、ソースコードとインポートパスを渡す。
    -   ParserManagerが、ソースコードの言語や内容を基に、適切なパーサーを選択する。
    -   アプリケーションサーバーが、選択されたパーサーを用いて、ソースコードの解析（構文解析、意味解析）を実行する。
    -   アプリケーションサーバーが、AI/RAG/MLサーバーを用いて、詳細解析を実行する。
    -   アプリケーションサーバーが、解析結果をメモリに格納しつつ、データベースに保存する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   ParserManager
    -   パーサー
    -   AI/RAG/MLサーバー
    -   PostgreSQL
    -   MongoDB
    -   Milvus

#### 7. 解析進捗のダッシュボード表示

-   **入力**:
    -   プロジェクトID
    -   解析進捗情報
-   **出力**:
    -   解析進捗状況のダッシュボード表示
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDに関連付けられた解析処理の進捗状況（解析種別、解析シミュレーション、AST作成、各種解析処理、解析完了など）をPostgreSQLから取得する。
    -   Webサーバーが、進捗情報を解析対象ソースコード毎に、わかりやすくダッシュボードに表示する。
    -   Webサーバーは、必要に応じて、進捗情報をリアルタイムに更新する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL

#### 8. AI/RAG/MLによる詳細解析

-   **入力**:
    -   プロジェクトID
    -   ソースコード、AST、メタデータ
    -   解析パラメータ（詳細解析の種類など）
-   **出力**:
    -   詳細解析結果（高度プログラム構造解析、バグ予測、問題点検出、コードクローン検出、技術的負債分析、セキュリティ脆弱性診断、コンプライアンスチェックなど）
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDに関連付けられたソースコード、AST、メタデータ、解析パラメータをAI/RAG/MLサーバーに送信する。
    -   AI/RAG/MLサーバーが、指定された詳細解析（高度プログラム構造解析、バグ予測、問題点検出、コードクローン検出、技術的負債分析、セキュリティ脆弱性診断、コンプライアンスチェックなど）を実行する。
    -   AI/RAG/MLサーバーが、RAGモデルを用いて、解析結果の根拠となる情報を外部知識ベースから検索し、結果に付与する。
    -   AI/RAG/MLサーバーが、詳細解析の結果をアプリケーションサーバーに返す。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   AI/RAG/MLサーバー

#### 9. 解析結果のデータベース保存

-   **入力**:
    -   プロジェクトID
    -   解析結果（AST、依存関係、メトリクス、詳細解析結果など）
-   **出力**:
    -   なし（データベースに保存）
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDと関連付けて、解析結果をPostgreSQL、MongoDB、Milvusに保存する。
    -   アプリケーションサーバーが、AST、メタデータ、コメント情報をMongoDBのソースコレクションに保存する。
    -   アプリケーションサーバーが、AI/RAG/MLサーバーによる詳細解析結果を、MongoDBの構造分析コレクション、分割統合管理コレクションに保存する。
    -   アプリケーションサーバーが、コードの埋め込み表現など、ベクトル化された解析結果をMilvusに保存する。
    -   アプリケーションサーバーが、解析結果のサマリ情報、メトリクスなどをPostgreSQLに保存する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL
    -   MongoDB
    -   Milvus

#### 10. 解析結果のダッシュボード表示

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   テンプレートマスタ
-   **出力**:
    -   解析結果のダッシュボード表示
-   **処理内容**:
    -   Webサーバーが、プロジェクトIDに関連付けられた解析結果を、アプリケーションサーバー経由で取得する。
    -   Webサーバーが、ダッシュボードに、テンプレートマスタの設定に従い、解析結果を、ユーザーが理解しやすいように、表形式、ツリービュー、各種グラフなどを用いて可視化して表示する。
    -   ユーザーが、可視化された解析結果を、ドリルダウン、フィルタリングなどの操作で詳細に確認できる。
    -   ユーザーが、解析結果の各要素（例：ASTのノード、依存関係のリンク）に対応するソースコードの位置を、容易に確認できる。
    -   ユーザーが、ダッシュボードから、解析結果のドキュメント出力を、条件を付して指示できる。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL（テンプレートマスタ）
    -   MongoDB（解析結果）

#### 11. 解析結果のドキュメント出力

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   テンプレートマスタ
    -   出力フォーマット（PDF, JSON, XML, CSVなど）
    -   出力条件
-   **出力**:
    -   指定されたフォーマットの解析結果ドキュメント
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDと出力条件に関連付けられた解析結果をデータベースから取得する。
    -   アプリケーションサーバーが、解析結果を、指定されたフォーマット（PDF, JSON, XML, CSVなど）に変換する。
    -   アプリケーションサーバーが、テンプレートマスタを参照し、テンプレートマスタに記載された指示内容に従い、出力するドキュメントのレイアウトやスタイルを適用する。
    -   アプリケーションサーバーが、変換された解析結果をドキュメントファイルとして出力する。
    -   Webサーバーが、出力されたドキュメントファイルをユーザーに提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL（テンプレートマスタ）
    -   MongoDB（解析結果）

#### 12. 解析履歴管理

-   **入力**:
    -   プロジェクトID
    -   解析日時、解析種別（単一ソース解析、複数ソースサマリ解析）、解析対象ソース、解析パラメータ、ユーザーなどの情報
-   **出力**:
    -   解析履歴一覧
    -   解析履歴詳細
-   **処理内容**:
    -   アプリケーションサーバーが、解析の実行情報をプロジェクトIDと関連付けてPostgreSQLに記録する。
    -   Webサーバーが、ユーザーからの要求に応じて、解析履歴一覧や詳細情報を表示する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL

#### 13. エラーハンドリング

-   **入力**:
    -   エラー情報（エラーメッセージ、エラーコード、発生箇所など）
-   **出力**:
    -   エラーメッセージ（ユーザー向け）
    -   エラーログ
-   **処理内容**:
    -   アプリケーションサーバーが、解析処理中に発生したエラーを検知する。
    -   アプリケーションサーバーが、エラー情報をログに記録する。
    -   アプリケーションサーバーが、エラーの原因を特定し、可能な場合は自動的に対処する。
    -   アプリケーションサーバーが、エラーメッセージを生成し、Webサーバー経由でユーザーに通知する。
    -   アプリケーションサーバーが、エラー発生時の状況を、プロジェクトのステータスとしてデータベース(PostgreSQL)に記録する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   MongoDB（エラーログの保存）

#### 14. 各種マスタとの連携

-   **入力**:
    -   なし
-   **出力**:
    -   なし
-   **処理内容**:
    -   アプリケーションサーバーが、解析処理の実行に必要な情報を、各種マスタから取得する。
    -   アプリケーションサーバーが、環境マスタからインポートパスや、AI/RAG/MLサーバーの接続情報などの設定情報を取得する。
    -   アプリケーションサーバーが、単一解析マスタから解析パラメータやパーサー設定を取得する。
    -   アプリケーションサーバーが、サマリ解析マスタから集計パラメータや出力定義を取得する。
    -   アプリケーションサーバーが、テンプレートマスタから、ダッシュボードやドキュメント出力のテンプレート情報を取得する。
    -   アプリケーションサーバーが、ダイアレクト基本マスタ、プロダクトマスタ、機能詳細マスタから、解析対象言語の方言情報を取得し、パーサーに設定する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（各種マスタの保存）

#### 15. ソース変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   ソース変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、ソース変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、ソース変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、ソース変換サービスの要求に応じて、変換対象ソースコードの特定部分の解析結果を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 16. DB変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   DB変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、DB変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、DB変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、DB変換サービスの要求に応じて、ソースコード内のDBアクセスに関連するコードの解析結果や、関連するDB定義情報（例：DB2の定義情報、VSAMの情報、IMS DBの情報）を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 17. 画面処理変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   画面処理変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、画面処理変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、画面処理変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、画面処理変換サービスの要求に応じて、ソースコード内の画面処理に関連するコード（例：CICSのBMSマップセット）の解析結果を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 18. フォーム処理変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   フォーム処理変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、フォーム処理変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、フォーム処理変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、フォーム処理変換サービスの要求に応じて、ソースコード内のフォーム処理に関連するコードの解析結果を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 19. 外部システム連携変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   外部システム連携変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、外部システム連携変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、外部システム連携変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、外部システム連携変換サービスの要求に応じて、ソースコード内の外部システム連携処理に関連するコード（例：ファイル連携、API呼び出し）の解析結果を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 20. ダイアレクト変換サービスとの連携

-   **入力**:
    -   プロジェクトID
    -   解析結果
    -   ダイアレクト変換サービスからの要求
-   **出力**:
    -   解析結果の一部または全部
-   **処理内容**:
    -   アプリケーションサーバーが、ダイアレクト変換サービスからの要求に応じて、プロジェクトIDに関連付けられた解析結果を提供する。
    -   アプリケーションサーバーは、ダイアレクト変換サービスが解析結果を利用しやすいように、APIを提供する。
    -   アプリケーションサーバーは、ダイアレクト変換サービスの要求に応じて、ソースコード内の特定の方言（例：IBM COBOLの拡張構文）に関連するコードの解析結果を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   PostgreSQL（解析結果の保存）
    -   MongoDB（解析結果の保存）

#### 21. 変換要否の判定

-   **入力**:
    -   プロジェクトID
    -   解析結果
-   **出力**:
    -   変換要否の判定結果（DB変換、画面処理変換、フォーム処理変換、外部システム連携変換、ダイアレクト変換の要否）
-   **処理内容**:
    -   アプリケーションサーバーが、プロジェクトIDに関連付けられた解析結果をデータベースから取得する。
    -   アプリケーションサーバーが、解析結果を分析し、変換対象ソースコードにDBアクセス関連コード、画面処理関連コード、フォーム処理関連コード、外部システム連携処理関連コード、ダイアレクト固有のコードが含まれているかを判定する。
    -   アプリケーションサーバーが、AI/RAG/MLサーバーと連携し、より高度な判定を行う。例えば、コード内にDBアクセス関連の記述がなくても、関連するJCLや定義体からDBアクセスが行われていることを特定する。
    -   アプリケーションサーバーが、判定結果（各変換の要否）をデータベースに保存し、Webサーバー経由でユーザーに提示する。また、ソース変換サービスがこの情報を参照できるようにする。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   Webサーバー
    -   PostgreSQL
    -   MongoDB
    -   AI/RAG/MLサーバー

#### 22. 知見の蓄積

-   **入力**:
    -   解析結果
    -   AI/RAG/MLサーバーによる解析結果
-   **出力**:
    -   なし（データベースに知識情報を蓄積）
-   **処理内容**:
    -   アプリケーションサーバー、またはAI/RAG/MLサーバーが、ソースコードの解析結果から、言語特性やロジックに関する有益な知識情報を抽出する。
    -   抽出された知識情報は、顧客や個人情報を含まない形で、データベース(PostgreSQL)の専用領域に蓄積される。
    -   蓄積された知識情報は、後続の解析処理において、AI/RAG/MLサーバーが参照し、解析精度の向上に役立てられる。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   AI/RAG/MLサーバー
    -   PostgreSQL

#### 23. 蓄積された知見の活用

-   **入力**:
    -   解析リクエスト
    -   蓄積された知識情報
-   **出力**:
    -   高精度な解析結果
    -   ユーザーへの有用な情報提供
-   **処理内容**:
    -   アプリケーションサーバーが、解析リクエストを受け付けると、AI/RAG/MLサーバーに解析を依頼する。
    -   AI/RAG/MLサーバーは、蓄積された知識情報を参照し、解析処理に活用する。例えば、過去に解析した類似コードの解析結果を参考にしたり、特定された言語特性を考慮したりすることで、解析精度を向上させる。
    -   AI/RAG/MLサーバーは、解析結果とともに、ユーザーに有用な情報（例：類似コードの存在、潜在的な問題点の指摘、改善提案など）を提供する。
-   **関連するサーバー**:
    -   アプリケーションサーバー
    -   AI/RAG/MLサーバー
    -   PostgreSQL（知識情報の蓄積）

## ソース解析 画面仕様概略

### 1. ソース解析メイン画面

-   **画面要素**:
    -   **タイトル**: 「ソース解析」
    -   **プロジェクト管理**:
        -   **新規プロジェクト作成**: ボタン（新規プロジェクト作成画面へ遷移）
        -   **プロジェクト一覧**: テーブル（プロジェクト名、顧客名、作成日時、ステータス、解析対象言語、解析種別などを表示）
        -   **プロジェクト選択**: ドロップダウンリスト（操作対象プロジェクトを選択）
        -   **プロジェクト設定**: ボタン（選択したプロジェクトの設定画面へ遷移）
    -   **解析結果**: 表示エリア（解析結果がツリービューやグラフなどで表示される）
    -   **解析結果のエクスポート**: ボタン（エクスポート形式を選択するドロップダウンリスト付き）
    -   **解析履歴参照**: ボタン（解析履歴画面へ遷移）
    -   **ヘルプ**: リンク
-   **画面遷移**:
    -   **新規プロジェクト作成** ボタンクリックで、新規プロジェクト作成画面に遷移する。
    -   **プロジェクト設定** ボタンクリックで、選択したプロジェクトの設定画面に遷移する。
    -   **解析結果のエクスポート** ボタンクリックで、エクスポート処理を実行する。
    -   **解析履歴参照** ボタンクリックで、解析履歴画面に遷移する。
-   **表示情報**:
    -   選択されたプロジェクトの解析結果概要（メトリクス、依存関係、AI/RAG/MLサーバーによる詳細解析結果の要約など）を、ダッシュボード形式で表示する。
    -   ユーザーは、表示された情報をドリルダウンして詳細を確認できる。
    -   ユーザーは、表示する情報の種類やレイアウトをカスタマイズできる。
-   **補足**:
    -   プロジェクト一覧テーブルには、顧客名を表示し、ユーザーが自身の所属する顧客のプロジェクトのみを閲覧・操作できるように制御する。

### 2. 新規プロジェクト作成画面

-   **画面要素**:
    -   **タイトル**: 「新規プロジェクト作成」
    -   **プロジェクト名**: テキストボックス
    -   **説明**: テキストエリア
    -   **顧客**: ドロップダウンリスト（顧客一覧から選択）
    -   **ソースコード**:
        -   **解析対象**: ラジオボタン（単一ファイル、複数ファイル）
        -   **ファイル選択**: ファイルアップロードボタン（単一ファイル、複数ファイル）、または、テキストエリア（直接入力）
        -   **URL入力欄**: テキストボックス
        -   **ディレクトリ選択**: ディレクトリ選択ボタン
        -   **ワイルドカード指定**: テキストボックス
        -   **リスト指定**: テキストエリア
    -   **解析種別**:
        -   **解析種別**: ラジオボタン（単一ソース解析、複数ソースサマリ解析）
    -   **作成** ボタン
    -   **キャンセル** ボタン
-   **画面遷移**:
    -   **作成** ボタンクリックで、プロジェクトを作成し、ソース解析メイン画面に遷移する。
    -   **キャンセル** ボタンクリックで、ソース解析メイン画面に遷移する。
-   **補足**:
    -   顧客は、ログインユーザーの情報から自動的に設定されるか、システム管理者が選択する。

### 3. プロジェクト設定画面

-   **画面要素**:
    -   **タイトル**: 「プロジェクト設定」
    -   **プロジェクト名**: テキストボックス（編集可能）
    -   **説明**: テキストエリア（編集可能）
    -   **顧客名**: テキスト表示（読み取り専用）
    -   **ソースコード**:
        -   **解析対象**: ラジオボタン（単一ファイル、複数ファイル）
        -   **ファイル選択**: ファイルアップロードボタン（単一ファイル、複数ファイル）、または、テキストエリア（直接入力）
        -   **URL入力欄**: テキストボックス
        -   **ディレクトリ選択**: ディレクトリ選択ボタン
        -   **ワイルドカード指定**: テキストボックス
        -   **リスト指定**: テキストエリア
    -   **解析種別**:
        -   **解析種別**: ラジオボタン（単一ソース解析、複数ソースサマリ解析）
    -   **解析パラメータ設定**:
        -   **解析対象言語**: ドロップダウンリスト（COBOL, アセンブラ, PL/1, Java, C/C++, VB/VBA, PHP, Rust, Python, .NET, C#から選択）
        -   **解析レベル**: ラジオボタン（構文解析、意味解析、詳細解析 *デフォルトは全て選択）
        -   **詳細設定**: ボタン（解析オプション詳細設定画面へ遷移）
        -   **インポートパス**: テキストボックス（環境マスタの設定値を表示、編集可能）
    -   **解析シミュレーション**: ボタン（解析シミュレーション画面へ遷移）
    -   **解析実行**: ボタン（解析実行画面へ遷移）
    -   **保存** ボタン
    -   **削除** ボタン
    -   **キャンセル** ボタン
-   **画面遷移**:
    -   **詳細設定** ボタンクリックで、解析オプション詳細設定画面に遷移する。
    -   **解析シミュレーション** ボタンクリックで、解析シミュレーション実行画面に遷移する。
    -   **解析実行** ボタンクリックで、解析実行画面に遷移する。
    -   **保存** ボタンクリックで、プロジェクト設定を更新し、ソース解析メイン画面に遷移する。
    -   **削除** ボタンクリックで、プロジェクトを削除し、ソース解析メイン画面に遷移する。
    -   **キャンセル** ボタンクリックで、ソース解析メイン画面に遷移する。
-   **補足**:
    -   プロジェクト名、説明は、プロジェクト作成後に変更可能とする。
    -   顧客名は、プロジェクト作成時に設定され、変更不可とする。

### 4. 解析オプション詳細設定画面

-   **画面要素**:
    -   **タイトル**: 「解析オプション詳細設定」
    -   **解析対象言語**: ドロップダウンリスト（COBOL, アセンブラ, PL/1, Java, C/C++, VB/VBA, PHP, Rust, Python, .NET, C#から選択）
    -   **解析レベル**: ラジオボタン（構文解析、意味解析、詳細解析 *デフォルトは全て選択）
    -   **AI/RAG/MLサーバー設定**:
        -   **利用する詳細解析**: チェックボックスリスト（高度プログラム構造解析、バグ予測、問題点検出、コードクローン検出、技術的負債分析、セキュリティ脆弱性診断、コンプライアンスチェックなど）
        -   **RAGモデルの外部知識ベース**: テキストボックス
    -   **適用するルール**: チェックボックスリスト（各解析ルールを選択）
    -   **詳細設定**: 各ルールの詳細設定項目（例：複雑度の閾値、コードクローン検出の類似度閾値）
    -   **保存** ボタン
    -   **キャンセル** ボタン
-   **画面遷移**:
    -   **保存** ボタンクリックで、設定内容を保存し、プロジェクト設定画面に遷移する。
    -   **キャンセル** ボタンクリックで、プロジェクト設定画面に遷移する。

### 5. 解析シミュレーション実行画面

-   **画面要素**:
    -   **タイトル**: 「解析シミュレーション実行」
    -   **実行** ボタン
    -   **進捗状況**: プログレスバー
    -   **キャンセル** ボタン
-   **画面遷移**:
    -   **実行** ボタンクリックで、シミュレーションを開始し、完了後、解析シミュレーション結果確認画面に遷移する。
    -   **キャンセル** ボタンクリックで、プロジェクト設定画面に遷移する。

### 6. 解析シミュレーション結果確認画面

-   **画面要素**:
    -   **タイトル**: 「解析シミュレーション結果」
    -   **サマリ情報**:
        -   **解析開始日時**: テキスト表示
        -   **解析終了日時**: テキスト表示
        -   **所要時間予測**: テキスト表示
        -   **問題点予測数**: テキスト表示
    -   **解析パラメータ**:
        -   **解析対象ソース**:リスト表示
        -   **解析種別**: テキスト表示
        -   **解析オプション**: リスト表示
    -   **シミュレーション結果詳細**:
        -   **予測所要時間**: テキスト表示、グラフ（各解析ステップの所要時間予測）
        -   **予測リソース使用量**: テキスト表示、グラフ（CPU、メモリ、ディスク使用量の予測）
        -   **検出された問題点**: テーブル（問題の種類、発生箇所、重大度などを表示）
        -   **AI/RAG/MLサーバーによる解析結果**: タブ（詳細解析結果を表示）
        -   **実行ログ**: テキストエリア
    -   **操作ボタン**:
        -   **パラメータを修正して再シミュレーション** ボタン
        -   **解析実行** ボタン
        -   **閉じる** ボタン
-   **画面遷移**:
    -   **パラメータを修正して再シミュレーション** ボタンクリックで、解析パラメータ設定画面に遷移する。
    -   **解析実行** ボタンクリックで、解析処理を実行し、解析結果表示画面に遷移する。
    -   **閉じる** ボタンクリックで、プロジェクト設定画面に遷移する。

### 7. 解析実行画面

-   **画面要素**:
    -   **タイトル**: 「解析実行」
    -   **実行** ボタン
    -   **進捗状況**: プログレスバー
    -   **キャンセル** ボタン
-   **画面遷移**:
    -   **実行** ボタンクリックで、解析処理を開始し、完了後、解析結果表示画面に遷移する。
    -   **キャンセル** ボタンクリックで、プロジェクト設定画面に遷移する。

### 8. 解析結果表示画面

-   **画面要素**:
    -   **タイトル**: 「解析結果」
    -   **解析結果**:
        -   **ソースコード**: 表示エリア（構文ハイライト付き）
        -   **AST**: ツリービュー
        -   **依存関係**: グラフ
        -   **メトリクス**: 表
        -   **AI/RAG/ML詳細解析結果**: タブ（詳細解析結果を表示）
            -   **高度プログラム構造解析**: 表やグラフ（モジュール構造、クラス構造、依存関係などを表示）
            -   **バグ予測**: 表（バグの可能性のある箇所、重大度などを表示）
            -   **問題点検出**: 表（問題のある箇所、問題の種類、重大度などを表示）
            -   **コードクローン検出**: 表（クローンコードの箇所、類似度などを表示）
            -   **技術的負債分析**: 表（技術的負債の項目、影響度などを表示）
            -   **セキュリティ脆弱性診断**: 表（脆弱性の箇所、種類、重大度などを表示）
            -   **コンプライアンスチェック**: 表（規約違反の箇所、内容などを表示）
            -   **根拠情報**: テキストエリア（AI/RAG/MLサーバーが参照した情報へのリンクなど）
        -   **その他、解析の種類に応じてタブを追加**
        -   **テストケース自動生成**: タブ（AI/RAG/MLサーバーが生成したテストケースを表示）
    -   **操作**:
        -   **ズームイン/アウト**: ボタン（AST、依存関係グラフを拡大縮小）
        -   **ノード/リンク情報**: 表示エリア（選択したノードやリンクの詳細情報を表示）
        -   **ソースコードと連携**: リンク（解析結果の要素をクリックすると、対応するソースコードの箇所にジャンプ）
    -   **テンプレート選択**: ドロップダウンリスト（ダッシュボードの表示テンプレートを選択）
    -   **エクスポート**: ボタン
    -   **保存**: ボタン
    -   **戻る** ボタン
-   **画面遷移**:
    -   **エクスポート** ボタンクリックで、エクスポート処理を実行する。
    -   **保存** ボタンクリックで、解析結果をデータベースに保存する。
    -   **戻る** ボタンクリックで、ソース解析メイン画面に遷移する。
-   **表示情報**:
    -   解析結果は、解析対象のソースコードと関連付けて表示される。例えば、ASTのノードを選択すると、対応するソースコードがハイライト表示される。
    -   依存関係グラフは、モジュール間やファイル間の依存関係を視覚的に表現する。
    -   メトリクスは、コードの複雑度や品質に関する指標を数値で表示する。
    -   AI/RAG/ML詳細解析結果は、AI/RAG/MLサーバーによって実行された詳細な解析の結果を表示する。バグ予測、コードクローン検出、技術的負債分析、セキュリティ脆弱性診断、コンプライアンスチェックなどの結果が含まれる。
    -   ユーザーは、表示された情報をドリルダウン、フィルタリング、ソーティングなどの操作で詳細に確認できる。
    -   テストケース自動生成タブには、AI/RAG/MLサーバーが生成した単体テストケース、結合テストケースが表示される。ユーザーは、テストケースを確認、編集、実行することができる。

### 9. 解析履歴画面

-   **画面要素**:
    -   **タイトル**: 「解析履歴」
    -   **検索条件**:
        -   **解析日時**: テキストボックス（範囲指定）
        -   **ユーザー**: テキストボックス
        -   **プロジェクト**: テキストボックス
        -   **言語**: ドロップダウンリスト
        -   **解析レベル**: ラジオボタン
        -   **解析種別**: ラジオボタン
        -   **検索** ボタン
    -   **履歴一覧**: テーブル（検索結果を表示）
    -   **詳細** ボタン（選択した履歴の詳細画面に遷移）
    -   **閉じる** ボタン
-   **画面遷移**:
    -   **詳細** ボタンクリックで、解析履歴詳細画面に遷移する。
    -   **閉じる** ボタンクリックで、ソース解析メイン画面に遷移する。

### 10. 解析履歴詳細画面

-   **画面要素**:
    -   **タイトル**: 「解析履歴詳細」
    -   **解析情報**:
        -   **解析日時**: テキスト表示
        -   **実行ユーザー**: テキスト表示
        -   **プロジェクト**: テキスト表示
        -   **言語**: テキスト表示
        -   **解析レベル**: テキスト表示
        -   **解析オプション**: テキスト表示
        -   **インポートパス**: テキスト表示
        -   **解析種別**: テキスト表示
    -   **解析結果**:
        -   **ソースコード**: 表示エリア（構文ハイライト付き）
        -   **AST**: ツリービュー
        -   **依存関係**: グラフ
        -   **メトリクス**: 表
        -   **AI/RAG/ML詳細解析結果**: タブ（詳細解析結果を表示）
            -   **高度プログラム構造解析**: 表やグラフ（モジュール構造、クラス構造、依存関係などを表示）
            -   **バグ予測**: 表（バグの可能性のある箇所、重大度などを表示）
            -   **問題点検出**: 表（問題のある箇所、問題の種類、重大度などを表示）
            -   **コードクローン検出**: 表（クローンコードの箇所、類似度などを表示）
            -   **技術的負債分析**: 表（技術的負債の項目、影響度などを表示）
            -   **セキュリティ脆弱性診断**: 表（脆弱性の箇所、種類、重大度などを表示）
            -   **コンプライアンスチェック**: 表（規約違反の箇所、内容などを表示）
            -   **根拠情報**: テキストエリア（AI/RAG/MLサーバーが参照した情報へのリンクなど）
        -   **その他、解析の種類に応じてタブを追加**
        -   **テストケース自動生成**: タブ（AI/RAG/MLサーバーが生成したテストケースを表示）
    -   **操作**:
        -   **ズームイン/アウト**: ボタン（AST、依存関係グラフを拡大縮小）
        -   **ノード/リンク情報**: 表示エリア（選択したノードやリンクの詳細情報を表示）
        -   **ソースコードと連携**: リンク（解析結果の要素をクリックすると、対応するソースコードの箇所にジャンプ）
    -   **テンプレート選択**: ドロップダウンリスト（ドキュメント出力のテンプレートを選択）
    -   **エクスポート**: ボタン
    -   **戻る** ボタン
-   **画面遷移**:
    -   **エクスポート** ボタンクリックで、エクスポート処理を実行する。
    -   **戻る** ボタンクリックで、解析履歴画面に遷移する。

**補足:**

-   各画面は、ユーザーフレンドリーなデザインとし、操作性を重視する。
-   入力値のバリデーションを行い、不正な値をエラー表示する。
-   操作ログを記録し、問題発生時の原因調査を容易にする。
-   解析結果表示画面、解析履歴詳細画面では、ユーザーが解析結果を確認しやすいように、情報を整理して表示する。例えば、重要な情報をハイライト表示したり、関連する情報をまとめて表示したりする。
-   解析結果表示画面、解析履歴詳細画面では、ユーザーが解析結果を理解しやすいように、専門用語の解説や、解析結果の解釈方法などを提示する。
-   **解析結果表示画面、解析履歴詳細画面では、ユーザーが解析結果を評価し、AI/RAG/MLサーバーにフィードバックを送信できる機能を備える。例えば、「良い」「悪い」の評価ボタンや、コメント入力欄を設ける。**
-   **解析結果表示画面、解析履歴詳細画面では、AI/RAG/MLサーバーによる解析結果と、ユーザーの評価やフィードバックを比較表示する機能を備える。例えば、ユーザーの評価とAIの予測が異なる箇所をハイライト表示するなど。**
-   **ユーザーが解析結果に基づいて、コードの改善目標を設定できる機能を実装する。例えば、複雑度の目標値を設定し、進捗状況を管理するなど。**
-   **ユーザーが解析結果を評価し、フィードバックを送信できる機能を実装する。AI/RAG/MLサーバーは、このフィードバックを学習し、解析精度を向上させる。**
-   **解析対象のソースコードが大規模な場合、解析処理を分割して実行し、進捗状況をユーザーにわかりやすく表示する機能を実装する。**
-   **解析結果画面に、ユーザーが自由にメモやコメントを書き込める機能を実装する。これにより、ユーザーは解析結果に対する気づきや考察を記録し、他のユーザーと共有することができる。**
-   **ユーザーが、解析結果や表示されたダッシュボードの項目に対して、タグ付けできる機能を実装する。例えば、「要確認」「修正予定」などのタグを付与し、後でフィルタリングや検索ができるようにする。**
-   **ユーザーが、解析結果の表示項目や表示順序をカスタマイズできる機能を実装する。**
-   **解析結果画面から、関連するソースコードの箇所に簡単にジャンプできる機能を実装する。例えば、解析結果の項目をクリックすると、対応するソースコードの行がハイライト表示されるなど。**
-   **解析結果画面に、ソースコードのバージョン情報を表示する機能を実装する。ユーザーは、解析結果がどのバージョンのソースコードに基づいているかを容易に確認できる。**
-   プロジェクト設定画面、解析オプション詳細設定画面では、前回解析時のパラメータやオプションをデフォルト値として表示し、ユーザーの入力の手間を省く。
-   解析結果画面に、AI/RAG/MLサーバーが解析に使用した外部知識ベースの情報を表示する機能を実装する。ユーザーは、AIの判断の根拠をより深く理解できる。
-   解析結果画面に、ユーザーがAI/RAG/MLサーバーに対して自然言語で質問できる機能を実装する。ユーザーは、解析結果についてより詳細な情報を得ることができる。
-   解析結果画面に、解析結果から自動生成されたテストケースを表示する機能を実装する。ユーザーは、生成されたテストケースを確認、編集、実行できる。
-   解析結果画面に、解析結果から自動生成されたプログラム仕様書を表示する機能を実装する。ユーザーは、生成された仕様書を確認、編集できる。

